<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WebSocket 비동기 테스트</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #output { border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: scroll; margin-top: 10px; }
        input, button { padding: 8px; margin-top: 10px; }
        input { width: 80%; }
        button { width: 18%; }
    </style>
</head>
<body>
    <h2>WebSocket 비동기 에코 테스트</h2>
    <div>
        <input type="text" id="message" placeholder="메시지 입력 (한글 가능)">
        <button onclick="sendMessage()">전송</button>
    </div>
    <div id="output"></div>

    <script>
        const socket = new WebSocket('ws://localhost:8080');
        const output = document.getElementById('output');
        
        // 연결 이벤트
        socket.onopen = function(e) {
            appendMessage('서버에 연결되었습니다.');
        };
        
        // 메시지 수신 이벤트
        socket.onmessage = function(event) {
            appendMessage(`서버로부터 응답: ${event.data}`);
        };
        
        // 연결 종료 이벤트
        socket.onclose = function(event) {
            if (event.wasClean) {
                appendMessage(`연결이 정상적으로 종료되었습니다. 코드: ${event.code}, 이유: ${event.reason}`);
            } else {
                appendMessage('연결이 강제로 종료되었습니다.');
            }
        };
        
        // 오류 이벤트
        socket.onerror = function(error) {
            appendMessage(`에러 발생: ${error.message}`);
        };
        
        // 메시지 전송 함수
        function sendMessage() {
            const messageInput = document.getElementById('message');
            const message = messageInput.value;
            
            if (message) {
                socket.send(message);
                appendMessage(`전송: ${message}`);
                messageInput.value = '';
            }
        }
        
        // 메시지 추가 함수
        function appendMessage(message) {
            const messageElement = document.createElement('div');
            messageElement.textContent = message;
            output.appendChild(messageElement);
            output.scrollTop = output.scrollHeight;
        }
        
        // Enter 키 이벤트 처리
        document.getElementById('message').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>